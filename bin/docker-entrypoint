#!/usr/bin/env bash

set -e

cmd="$@"

# Wait for PostgreSQL
until PGPASSWORD=$DB_PASSWORD psql -h $DB_HOST -U $DB_USER -d $DB_NAME -c "\q" 2>&1; do
  echo -e "\e[93mWaiting for PostgreSQL...\e[39m"
  sleep 1
done

echo -e "\e[32mPostgres is up and running - executing command\e[39m"

# If a server was running, end it
if [ -f tmp/pids/server.pid ]; then
  rm tmp/pids/server.pid
fi

exec $cmd